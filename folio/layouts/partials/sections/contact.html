{{/* Section Contact — Formulaire multi-mode sécurisé (HUG-26) */}}
{{ $contact := .Site.Params.contact }}
{{ $method := $contact.formMethod | default "api" }}

<section class="section section--contact" id="contact">
  <div class="container">
    <div class="section__header" data-animate>
      <h2 class="section__title">
        {{ with $contact.title }}{{ . }}{{ else }}{{ i18n "contact_title" | default "Contact" }}{{ end }}
      </h2>
    </div>

    <div class="contact__wrapper" data-animate>
      <form
        id="contact-form"
        class="contact__form"
        {{ if eq $method "netlify" }}
          name="contact"
          method="POST"
          data-netlify="true"
          data-netlify-honeypot="{{ $contact.honeypotField | default "website" }}"
        {{ else if eq $method "formspree" }}
          action="{{ $contact.formAction }}"
          method="POST"
        {{ else }}
          action="#"
          method="POST"
        {{ end }}
        data-form-method="{{ $method }}"
        {{ if eq $method "api" }}data-form-action="{{ $contact.formAction }}"{{ end }}
        novalidate
      >
        {{/* Honeypot — champ invisible anti-bot (SECURITE) */}}
        <div class="contact__honeypot" aria-hidden="true" tabindex="-1">
          <label for="contact-{{ $contact.honeypotField | default "website" }}">
            {{ $contact.honeypotField | default "website" }}
          </label>
          <input
            type="text"
            id="contact-{{ $contact.honeypotField | default "website" }}"
            name="{{ $contact.honeypotField | default "website" }}"
            autocomplete="off"
            tabindex="-1"
          >
        </div>

        <div class="contact__grid">
          {{/* Nom */}}
          <div class="contact__field">
            <label for="contact-name" class="contact__label">
              {{ i18n "contact_name" | default "Nom" }} <span aria-hidden="true">*</span>
            </label>
            <input
              type="text"
              id="contact-name"
              name="name"
              required
              maxlength="100"
              class="contact__input"
              autocomplete="name"
            >
          </div>

          {{/* Email */}}
          <div class="contact__field">
            <label for="contact-email" class="contact__label">
              {{ i18n "contact_email" | default "Email" }} <span aria-hidden="true">*</span>
            </label>
            <input
              type="email"
              id="contact-email"
              name="email"
              required
              maxlength="255"
              class="contact__input"
              autocomplete="email"
            >
          </div>

          {{/* Téléphone (optionnel) */}}
          <div class="contact__field">
            <label for="contact-phone" class="contact__label">
              {{ i18n "contact_phone" | default "Téléphone" }}
            </label>
            <input
              type="tel"
              id="contact-phone"
              name="phone"
              class="contact__input"
              autocomplete="tel"
            >
          </div>

          {{/* Sujet */}}
          {{ with $contact.subjects }}
          <div class="contact__field">
            <label for="contact-subject" class="contact__label">
              {{ i18n "contact_subject" | default "Sujet" }}
            </label>
            <select id="contact-subject" name="subject" class="contact__input contact__select">
              <option value="">{{ i18n "contact_select_default" | default "—" }}</option>
              {{ range . }}
              <option value="{{ . }}">{{ . }}</option>
              {{ end }}
            </select>
          </div>
          {{ end }}
        </div>

        {{/* Message */}}
        <div class="contact__field contact__field--full">
          <label for="contact-message" class="contact__label">
            {{ i18n "contact_message" | default "Message" }} <span aria-hidden="true">*</span>
          </label>
          <textarea
            id="contact-message"
            name="message"
            required
            maxlength="2000"
            rows="6"
            class="contact__input contact__textarea"
          ></textarea>
        </div>

        {{/* Bouton + Messages */}}
        <div class="contact__actions">
          <button type="submit" class="btn btn--primary contact__submit" id="contact-submit">
            <span class="contact__submit-text">{{ i18n "contact_send" | default "Envoyer" }}</span>
            <span class="contact__submit-loading" aria-hidden="true">{{ i18n "contact_sending" | default "Envoi..." }}</span>
          </button>
        </div>

        {{/* Messages feedback */}}
        <div id="contact-feedback" class="contact__feedback" role="alert" aria-live="polite"></div>
      </form>
    </div>
  </div>
</section>

{{/* Messages i18n passés au JS via data attributes (pas de script inline) */}}
<script type="application/json" id="contact-i18n">
{
  "success": {{ (($contact.successMessage | default (i18n "contact_success" | default "Message envoyé avec succès !")) | jsonify) }},
  "error": {{ (($contact.errorMessage | default (i18n "contact_error" | default "Une erreur est survenue. Veuillez réessayer.")) | jsonify) }}
}
</script>
